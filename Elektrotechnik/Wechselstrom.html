<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Beschreibung der Seite -->
    <meta name="description" content="Effektivwert von Wechselspannungen berechnen.">
	<!-- Stichworte fuer Suchmaschinen -->
    <meta name="keywords" content="Elecalculate, Elektrotechnik, Berechnungen, Wecheselstrom, Sinus, Recheck, Dreieck, PWM, Effektivwert">
    <title>Elektrotechnik | Wechselstrom</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" type="image/png" href="../Pictures/favicon.png">
    <style>
        
        /***********/
        .img-button {
            position: relative;
            width: 100px; /* Adjust as needed */
            height: 100px; /* Adjust as needed */
            border: 2px solid transparent; /* Initially transparent */
            padding: 0;
            margin: 10px;
            background-color: transparent;
            cursor: pointer;
        }
        
        .img-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .img-button:hover {
            border-color: grey; /* grey border for hovered button */
        }
        
        .img-button.selected {
            border-color: white; /* White border for selected button */
        }
        
        .img-button span {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 14px;
            padding: 2px 0;
        }
        /***********/
        
        input {
            border: 2px solid;
            border-radius: 3px;
        }

        input:focus {
            /*border: 3px solid;*/
            outline: none; /* Entfernt den Standard-Umrandungsring */
        }

        /* Stil fuer das Formular und Layout */
        .input-numbers {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 20px;
            max-width: 600px; /* Setzt eine maximale Breite */
            margin: 0 auto; /* Zentriert das Formular */
            /*margin-left: 10px;*/
        }

        .RAD-Button 
        {
            background: none;
            /*border: 1px solid var(--Winkel);
            border-radius: 3px;
            /*margin-top: 10px;
            min-width: 50px;
            height: 29px;*/
            color: inherit;
            padding: 0;
            cursor: pointer;
            flex: 3;
            text-align: left;
        }

        .RAD-Button:hover{
            text-decoration: underline;
        }


        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
            margin-left: 10px;
            
        }

        .form-row label {
            flex: 3;
            text-align: left;
            margin-right: 10px;

        }

        h3 {
            margin-top: 20px;
        }

        .results{
            line-height: 2; /* Multiplikator fuer die Schriftgroesse */
        }

        .fraction
        {
            display: inline-block; 
            vertical-align: middle; 
            text-align: center;
            margin-top: 1px;
            margin-bottom: 1px;
            line-height: 1.5; /* Multiplikator fuer die Schriftgroesse */
        }

        .fraction-numerator{
            border-bottom: 1px solid;
            padding-bottom: 0.2px; /* Sorgt fuer einen Abstand innerhalb des Elements */
            display: inline-block; /* Macht die Anpassungen besser sichtbar */
        }

        .fraction-denominator {
            border-top: 1px solid;
        }

        img{
            width: 80%;
            max-width: 600px;
        }
    </style>
</head>
<body>
    <header>
        <div class="burger-menu" onclick="toggleMenu()">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
        </div>
        <div class="scroll-container">
            <ul class="main-menu">
                <li><a href="elektrotechnik.html">Elektrotechnik</a></li>
                <li><a href="Gleichstrom.html">Gleichstrom</a></li>
                <li><a class="active" href="#Wechselstrom">Wechselstrom</a></li>
                <li><a href="Transformator.html">Transformator</a></li>
                <li><a href="Magnetismus.html">Magnetismus</a></li>
                <li><a href="Kondensator.html">Kondensator</a></li>
                <li><a href="Spule.html">Spule</a></li>
                <li><a href="Schwingkreis.html">Schwingkreis</a></li>
                <li><a href="Verstaerkung_Daempfung.html">Verst&auml;rkung/D&auml;mpfung</a></li>
                <li><a href="Filter.html">Filter</a></li>
            </ul>
        </div>
        <nav class="dropdown-menu">
            <ul>
                <li><a href="../index.html">Allgemein</a></li>
                <li><a href="#Elektrotechnik">Elektrotechnik</a></li>
                <li><a href="../Elektronik/elektronik.html">Elektronik</a></li>
                <li><a href="../HST/hst.html">HST</a></li>
            </ul>
        </nav>
    </header>
    <div class="wrapper">
        <main>
            <div>
                <h1><br>Wechselstrom</h1>
            </div>
            <div>
                <button class="img-button" type="button" onclick="toggleSelection(this, 'Sinus')">
                    <img src="../Pictures/Sinus.jpg" alt="Sinus">
                    <span>Sinus</span>
                </button>
                <button class="img-button" type="button" onclick="toggleSelection(this, 'Rechteck')">
                    <img src="../Pictures/Rechteck.jpg" alt="Rechteck">
                    <span>Rechteck</span>
                </button>
                <button class="img-button" type="button" onclick="toggleSelection(this, 'Dreieck')">
                    <img src="../Pictures/Dreieck.jpg" alt="Dreieck">
                    <span>Dreieck</span>
                </button>
                <button class="img-button" type="button" onclick="toggleSelection(this, 'PWM')">
                    <img src="../Pictures/PWM.jpg" alt="PWM">
                    <span>PWM</span>
                </button>
            </div>

            <!--Sinus------------------------------------------------------------------------------------------------->
            <div id="Sinus" style="display:none;" class="input-numbers">
                <h2>Sinus</h2>

                <div class="comment">
                    Werte mit Massvorsatz eingeben z.B. U<sub>eff</sub> = 20mV &rarr; Eingabe: 20m (nicht 20mV)<br>
                    Mit einem Klick auf die Einheit das Winkels kann zwischen RAD und DEG umgestellt werden<br>
                </div>

                <!-- Spannung -->
                <div class="form-row">
                    <label>Momentanwert u(t)</label>
                    <input type="text" id="ut-Sinus" style="border-color: var(--Spannung);">
                    <label>V [Volt]</label>
                </div>

                <div class="form-row">
                    <label>Peakspannung u<sub>p</sub> / &ucirc;</label>
                    <input type="text" id="up-Sinus" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <div class="form-row">
                    <label>Peak-Peakspannung u<sub>pp</sub></label>
                    <input type="text" id="upp-Sinus" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <!--<div class="form-row">
                    <label>DC-Offsetspannung U<sub>DC</sub></label>
                    <input type="text" id="Udc-Sinus" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>-->

                <div class="form-row">
                    <label>Effektivspannung U<sub>eff</sub></label>
                    <input type="text" id="Ueff-Sinus" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <!--Frequenz f-->
                <div class="form-row">
                    <label>Frequenz f</label>
                    <input type="text" id="f-Sinus" style="border-color: var(--Frequenz);">
                    <label>Hz [Hertz] </label>
                </div>

                <!--Zeit-->
                <div class="form-row">
                    <label>aktueller Zeitpunkt t</label>
                    <input type="text" id="t-Sinus" style="border-color: var(--Zeit);">
                    <label>s [sekunden] </label>
                </div>

                <div class="form-row">
                    <label>Periodendauer T</label>
                    <input type="text" id="T-Sinus" style="border-color: var(--Zeit);">
                    <label>s [sekunden] </label>
                </div>

                <!-- Winkel phi -->
                <div class="form-row">
                    <label>Winkel &phi;</label>
                    <input type="text" id="Winkel-Sinus" style="border-color: var(--Winkel);">
                    <label><button id="Rad-Button" class="RAD-Button" onclick="toggleRAD()">2&pi;</button></label>
                </div>

                <input type="button" value="Berechnen" class="Button_Berechnen" onclick="calculate_Sinus()">


                <h3>Berechnete Ergebnisse</h3>
                <p id="result_Sinus"></p>

                
                <!-- Canvas fÃ¼r Sinuskurve -->
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div style="font-weight: bold; color: #fff; padding: 6px 0; width: 100%; text-align: center; max-width: 1200px;">
                        <h3>Grafische Sinuskurve:</h3>
                    </div>
                    <div style="display: flex; justify-content: center; width: 100%;">
                        <canvas id="sinusCanvas" width="1200" height="400"
                            style="background:#222; border:1px solid #666; display:block; margin:10px auto;">
                        </canvas>
                    </div>
                </div>
            </div>

            <!--Rechteck------------------------------------------------------------------------------------------------->
            <div id="Rechteck" style="display:none;" class="input-numbers">
                <h2>Rechteck</h2>

                <div class="comment">
                    Werte mit Massvorsatz eingeben z.B. U<sub>eff</sub> = 20mV &rarr; Eingabe: 20m (nicht 20mV)<br><br>
                </div>

                <!-- Spannung -->
                <div class="form-row">
                    <label>Peakspannung u<sub>p</sub> / &ucirc;</label>
                    <input type="text" id="up-Rechteck" style="border-color: var(--Spannung);">
                    <label>V [Volt]</label>
                </div>

                <div class="form-row">
                    <label>Peak-Peakspannung u<sub>pp</sub></label>
                    <input type="text" id="upp-Rechteck" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <div class="form-row">
                    <label>Effektivspannung U<sub>eff</sub></label>
                    <input type="text" id="Ueff-Rechteck" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <input type="button" value="Berechnen" class="Button_Berechnen" onclick="calculate_Rechteck()">

                <h3>Berechnete Ergebnisse</h3>
                <p id="result_Rechteck"></p>
            </div>

            <!--Dreieck------------------------------------------------------------------------------------------------->
            <div id="Dreieck" style="display:none;" class="input-numbers">
                <h2>Dreieck / S&auml;gezahn</h2>

                <div class="comment">
                    Werte mit Massvorsatz eingeben z.B. U<sub>eff</sub> = 20mV &rarr; Eingabe: 20m (nicht 20mV)<br><br>
                </div>

                <!-- Spannung -->
                <div class="form-row">
                    <label>Peakspannung u<sub>p</sub> / &ucirc;</label>
                    <input type="text" id="up-Dreieck" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <div class="form-row">
                    <label>Peak-Peakspannung u<sub>pp</sub></label>
                    <input type="text" id="upp-Dreieck" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <div class="form-row">
                    <label>Effektivspannung U<sub>eff</sub></label>
                    <input type="text" id="Ueff-Dreieck" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <input type="button" value="Berechnen" class="Button_Berechnen" onclick="calculate_Dreieck()">

                <h3>Berechnete Ergebnisse</h3>
                <p id="result_Dreieck"></p>
            </div>

            <!--PWM------------------------------------------------------------------------------------------------->
            <div id="PWM" style="display:none;" class="input-numbers">
                <h2>PWM</h2>

                <div class="comment">
                    Werte mit Massvorsatz eingeben z.B. U<sub>eff</sub> = 20mV &rarr; Eingabe: 20m (nicht 20mV)<br>
                    Mit einem Klick auf die Einheit das Duty-Cycles kann zwischen % und ganzzahlig umgestellt werden<br>
                </div>

                <!-- Spannung -->
                <div class="form-row">
                    <label>Peakspannung u<sub>p</sub> / &ucirc;</label>
                    <input type="text" id="up-PWM" style="border-color: var(--Spannung);">
                    <label>V [Volt]</label>
                </div>

                <div class="form-row">
                    <label>Effektivspannung U<sub>eff</sub></label>
                    <input type="text" id="Ueff-PWM" style="border-color: var(--Spannung);">
                    <label>V [Volt] </label>
                </div>

                <!--Frequenz f-->
                <div class="form-row">
                    <label>Frequenz f</label>
                    <input type="text" id="f-PWM" style="border-color: var(--Frequenz);">
                    <label>Hz [Hertz] </label>
                </div>

                <!--Zeit-->
                <div class="form-row">
                    <label>Impulsdauer t<sub>in</sub></label>
                    <input type="text" id="tin-PWM" style="border-color: var(--Zeit);">
                    <label>s [sekunden] </label>
                </div>

                <div class="form-row">
                    <label>Periodendauer T</label>
                    <input type="text" id="T-PWM" style="border-color: var(--Zeit);">
                    <label>s [sekunden] </label>
                </div>

                <!--Duty cylce-->
                <div class="form-row">
                    <label>Duty-Cycle g</sub></label>
                    <input type="text" id="g-PWM" style="border-color: gray;">
                    <label><button id="Duty-Button" class="RAD-Button" onclick="toggleDuty()">%</button></label>
                </div>

                <input type="button" value="Berechnen" class="Button_Berechnen" onclick="calculate_PWM()">

                <h3>Berechnete Ergebnisse</h3>
                <p id="result_PWM"></p>
            </div>

            <br>
        </main>

        <footer>
            &copy; 2025 Elecalculate
        </footer>
    </div>
    <script src="../scripts.js"></script>
    <script>
        let selectedButton = null;

        function toggleSelection(button, sectionId) {
            const section = document.getElementById(sectionId);
            
            if (selectedButton === button) {
                // Deselect if the same button is clicked again
                button.classList.remove('selected');
                section.style.display = 'none';
                selectedButton = null;
            } else {
                // Remove selection from the previously selected button
                if (selectedButton) {
                    selectedButton.classList.remove('selected');
                }
                
                // Select the new button
                button.classList.add('selected');
                selectedButton = button;

                // Show the selected section and hide the other
                if (sectionId === 'Sinus') {
                    document.getElementById('Sinus').style.display = 'block';
                    document.getElementById('Rechteck').style.display = 'none';
                    document.getElementById('Dreieck').style.display = 'none';
                    document.getElementById('PWM').style.display = 'none';
                } else if(sectionId === 'Rechteck') {
                    document.getElementById('Sinus').style.display = 'none';
                    document.getElementById('Rechteck').style.display = 'block';
                    document.getElementById('Dreieck').style.display = 'none';
                    document.getElementById('PWM').style.display = 'none';
                } else if (sectionId === 'Dreieck') {
                    document.getElementById('Sinus').style.display = 'none';
                    document.getElementById('Rechteck').style.display = 'none';
                    document.getElementById('Dreieck').style.display = 'block';
                    document.getElementById('PWM').style.display = 'none';
                } else if (sectionId === 'PWM') {
                    document.getElementById('Sinus').style.display = 'none';
                    document.getElementById('Rechteck').style.display = 'none';
                    document.getElementById('Dreieck').style.display = 'none';
                    document.getElementById('PWM').style.display = 'block';
                }
            }
        }

        let isRADactive = true; // Standard: Radian (2Ï)
        function toggleRAD() 
        {
            let button = document.getElementById("Rad-Button");

            if (isRADactive) {
                button.innerHTML = "360&deg;"; // Wechselt zu Grad
                isRADactive = false;
            } else {
                button.innerHTML = "2&pi;"; // Wechselt zurÃ¼ck zu Radian
                isRADactive = true;
            }
        }

        let isPercent = true;
        function toggleDuty() 
        {
            let button = document.getElementById("Duty-Button");

            if (isPercent) {
                button.innerHTML = "1"; // Wechselt zu Grad
                isPercent = false;
            } else {
                button.innerHTML = "%"; // Wechselt zurÃ¼ck zu Radian
                isPercent = true;
            }
        }

        /**
         * Reads all Sinusâcalculator inputs, computes any missing values,
         * writes the algebraic results into the page, then draws one
         * period of the sine wave on the canvas.
         */
        function calculate_Sinus() {
        // 1) Read raw string inputs
        const utRaw   = document.getElementById("ut-Sinus").value;
        const upRaw   = document.getElementById("up-Sinus").value;
        const uppRaw  = document.getElementById("upp-Sinus").value;
        const UeffRaw = document.getElementById("Ueff-Sinus").value;
        const fRaw    = document.getElementById("f-Sinus").value;
        const tRaw    = document.getElementById("t-Sinus").value;
        const TRaw    = document.getElementById("T-Sinus").value;
        const phiRaw  = document.getElementById("Winkel-Sinus").value;

        // 2) Convert to numeric values (parse prefixes)
        const ut   = parseInput(utRaw);
        const up   = parseInput(upRaw);
        const upp  = parseInput(uppRaw);
        const Ueff = parseInput(UeffRaw);
        const f    = parseInput(fRaw);
        const t    = parseInput(tRaw);
        const T    = parseInput(TRaw);
        // Always convert phase to radians
        const phi  = isRADactive
                    ? parseInput(phiRaw)
                    : parseInput(phiRaw) * Math.PI / 180;

        // 3) Build HTML for all possible computations
        let html = "";

        // Instantaneous u(t)
        if (!ut && up && f && t) {
            const val = up * Math.sin(2 * Math.PI * f * t);
            html +=
            `<strong>u(t) = Ã»Â·sin(2ÏÂ·fÂ·t)</strong> = ` +
            `${upRaw}Â·sin(2ÏÂ·${fRaw}Â·${tRaw}) = ` +
            `${formatWithPrefix(val, "V")}<br>`;
        }
        if (!ut && up && phiRaw) {
            const val = up * Math.sin(phi);
            html +=
            `<strong>u(t) = Ã»Â·sin(Ï)</strong> = ` +
            `${upRaw}Â·sin(${phiRaw}${isRADactive ? " rad" : "Â°"}) = ` +
            `${formatWithPrefix(val, "V")}<br>`;
        }

        // Peak voltage Ã»
        if (!up && utRaw && f && t) {
            const val = ut / Math.sin(2 * Math.PI * f * t);
            html +=
            `<strong>Ã» = u(t)/sin(2Ïft)</strong> = ` +
            `${utRaw}/${`sin(2ÏÂ·${fRaw}Â·${tRaw})`} = ` +
            `${formatWithPrefix(val, "V")}<br>`;
        }
        if (!up && upp) {
            const val = upp / 2;
            html +=
            `<strong>Ã» = u_pp / 2</strong> = ` +
            `${uppRaw}/2 = ${formatWithPrefix(val, "V")}<br>`;
        }
        if (!up && Ueff) {
            const val = Ueff * Math.SQRT2;
            html +=
            `<strong>Ã» = U_effÂ·â2</strong> = ` +
            `${UeffRaw}Â·â2 = ${formatWithPrefix(val, "V")}<br>`;
        }

        // Peakâpeak u_pp
        if (!upp && up) {
            const val = up * 2;
            html +=
            `<strong>u_pp = 2Â·Ã»</strong> = 2Â·${upRaw} = ` +
            `${formatWithPrefix(val, "V")}<br>`;
        }
        if (!upp && Ueff) {
            const val = Ueff * 2 * Math.SQRT2;
            html +=
            `<strong>u_pp = 2Â·U_effÂ·â2</strong> = ` +
            `2Â·${UeffRaw}Â·â2 = ${formatWithPrefix(val, "V")}<br>`;
        }

        // Effective U_eff
        if (!Ueff && up) {
            const val = up / Math.SQRT2;
            html +=
            `<strong>U_eff = Ã»/â2</strong> = ${upRaw}/â2 = ` +
            `${formatWithPrefix(val, "V")}<br>`;
        }
        if (!Ueff && upp) {
            const val = upp / (2 * Math.SQRT2);
            html +=
            `<strong>U_eff = u_pp/(2â2)</strong> = ` +
            `${uppRaw}/(2â2) = ${formatWithPrefix(val, "V")}<br>`;
        }

        // Frequency f
        if (!f && T) {
            const val = 1 / T;
            html +=
            `<strong>f = 1/T</strong> = 1/${TRaw}s = ` +
            `${formatWithPrefix(val, "Hz")}<br>`;
        }

        // Period T
        if (!T && f) {
            const val = 1 / f;
            html +=
            `<strong>T = 1/f</strong> = 1/${fRaw}Hz = ` +
            `${formatWithPrefix(val, "s")}<br>`;
        }

        // Phase Ï
        if (!phiRaw && f && t) {
            const valRad = 2 * Math.PI * f * t;
            html +=
            `<strong>Ï (rad) = 2Ïft</strong> = ` +
            `2ÏÂ·${fRaw}Â·${tRaw} = ${valRad.toFixed(3)} rad<br>` +
            `<strong>Ï (Â°) = 360ft</strong> = ` +
            `360Â·${fRaw}Â·${tRaw} = ${(360 * f * t).toFixed(1)}Â°<br>`;
        }
        if (!phiRaw && ut && up) {
            const ratio = ut / up;
            const valRad = Math.asin(ratio);
            html +=
            `<strong>Ï = arcsin(u(t)/Ã»)</strong> = ` +
            `arcsin(${utRaw}/${upRaw}) = ` +
            `${valRad.toFixed(3)} rad (${(valRad*180/Math.PI).toFixed(1)}Â°)<br>`;
        }

        // Time t
        if (!t && up && ut && f) {
            const val = Math.asin(ut / up) / (2 * Math.PI * f);
            html +=
            `<strong>t = arcsin(u/Ã»)/(2Ïf)</strong> = ` +
            `${formatWithPrefix(val, "s")}<br>`;
        }
        if (!t && phiRaw && f) {
            const val = phi / (2 * Math.PI * f);
            html +=
            `<strong>t = Ï/(2Ïf)</strong> = ` +
            `${formatWithPrefix(val, "s")}<br>`;
        }

        // 4) Write all results:
        document.getElementById("result_Sinus").innerHTML = html;

        // 5) Finally draw the sine if we have peak and frequency
        const tVal = parseInput(document.getElementById("t-Sinus").value) || 0;

        if (up > 0 && f > 0) {
        // draw exactly 2 periods, using tVal only for the dot:
        drawSinus(up, f, phi, tVal, 2);
        }
        }

        /**
        * Draws a labeled sine wave with axes, grid, marker, helper lines, and legend.
        * If required values are missing or invalid, shows a placeholder message.
        *
        * @param {number} up       Peak amplitude [V]
        * @param {number} f        Frequency [Hz]
        * @param {number} phi      Phase [rad]
        * @param {number} tMarker  Time [s] to mark
        * @param {number} periods  Number of periods to display (default: 2)
        */
        function drawSinus(up, f, phi, tMarker, periods = 2) {
        const canvas = document.getElementById("sinusCanvas");
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        const W   = canvas.width, H = canvas.height;
        const midY = H / 2;
        const margin = 50, marginR = 20;

        // === 1. Placeholder logic ===
        // If both up and f are empty/zero, show a neutral prompt.
        if ((!up && !f) || (up === "" && f === "")) {
            ctx.clearRect(0, 0, W, H);
            ctx.fillStyle = "#888";
            ctx.font = "bold 20px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(
            "Bitte Werte fÃ¼r Ã» (Peak) und f (Frequenz) eingeben.",
            W / 2, H / 2
            );
            return;
        }
        // If up or f is missing, zero, or invalid, show an error placeholder.
        if (!up || !f || isNaN(up) || isNaN(f) || up <= 0 || f <= 0) {
            ctx.clearRect(0, 0, W, H);
            ctx.fillStyle = "#e66";
            ctx.font = "bold 20px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(
            "Sinuskurve kann nicht berechnet werden.",
            W / 2, H / 2 - 10
            );
            ctx.font = "14px sans-serif";
            ctx.fillStyle = "#fff";
            ctx.fillText(
            "Bitte gÃ¼ltige Werte fÃ¼r Ã» (Peak) und f (Frequenz) eingeben.",
            W / 2, H / 2 + 20
            );
            return;
        }

        // === 2. Prepare plot area and scaling ===
        const plotW = W - margin - marginR;
        const Tsec  = 1 / f;                // Period duration in seconds
        const total = periods * Tsec;       // Total time shown in seconds
        const pxPerS = plotW / total;       // Pixels per second
        const scaleY = (midY - 20) / up;    // Pixels per volt (with margin)

        // === 3. Clear canvas ===
        ctx.clearRect(0, 0, W, H);

        // === 4. Draw fine horizontal grid lines ===
        ctx.strokeStyle = "#333";
        ctx.lineWidth   = 0.5;
        for (let i = -4; i <= 4; i++) {
            const y = midY - i * (up/4) * scaleY;
            ctx.beginPath();
            ctx.moveTo(margin, y);
            ctx.lineTo(W - marginR, y);
            ctx.stroke();
        }

        // === 5. Draw axes ===
        ctx.strokeStyle = "#888";
        ctx.lineWidth   = 1;
        ctx.beginPath();
            ctx.moveTo(margin, midY);
            ctx.lineTo(W - marginR, midY);
            ctx.moveTo(margin, 0);
            ctx.lineTo(margin, H);
        ctx.stroke();

        // === 6. Draw axis ticks and labels ===
        ctx.fillStyle = "#888";
        ctx.font      = "12px sans-serif";
        ctx.textAlign = "center";
        // X-axis (time)
        for (let p = 0; p <= periods; p++) {
            const x = margin + p*Tsec*pxPerS;
            ctx.beginPath();
            ctx.moveTo(x, midY-5);
            ctx.lineTo(x, midY+5);
            ctx.stroke();
            ctx.fillText(`${(p*Tsec*1000).toFixed(0)}ms`, x, midY+20);
        }
        // Y-axis (voltage)
        ctx.textAlign = "right";
        for (let i = -4; i <= 4; i++) {
            if (i===0) continue;
            const y = midY - i*(up/4)*scaleY;
            ctx.beginPath();
            ctx.moveTo(margin-5, y);
            ctx.lineTo(margin+5, y);
            ctx.stroke();
            ctx.fillText(`${(i*up/4).toFixed(0)}V`, margin-10, y+4);
        }

        // === 7. Draw sine curve in blue (var(--Spannung) or fallback) ===
        const sinusColor = getComputedStyle(document.documentElement)
                            .getPropertyValue("--Spannung").trim() || "#0070C0";
        ctx.strokeStyle = sinusColor;
        ctx.lineWidth   = 2;
        ctx.beginPath();
        for (let px = 0; px <= plotW; px++) {
            const time  = px / pxPerS;
            const angle = 2*Math.PI*f*time + phi;
            const yVal  = up * Math.sin(angle);
            const xPix  = margin + px;
            const yPix  = midY - yVal * scaleY;
            px===0 ? ctx.moveTo(xPix,yPix) : ctx.lineTo(xPix,yPix);
        }
        ctx.stroke();

        // === 8. Draw marker, helper lines, and labels ===
        // Wrap tMarker into the visible window
        const tWrapped = ((tMarker % total) + total) % total;
        const uAtT     = up * Math.sin(2*Math.PI*f*tWrapped + phi);
        const xT       = margin + tWrapped*pxPerS;
        const yT       = midY - uAtT*scaleY;

        if (xT >= margin && xT <= margin+plotW) {
            // Dashed vertical line (from x-axis to marker)
            ctx.save();
            ctx.strokeStyle = "deeppink";
            ctx.lineWidth = 1.5;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(xT, midY);
            ctx.lineTo(xT, yT);
            ctx.stroke();

            // Dashed horizontal line (from y-axis to marker)
            ctx.beginPath();
            ctx.moveTo(margin, yT);
            ctx.lineTo(xT, yT);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.restore();

            // Label for vertical line (time)
            ctx.save();
            ctx.fillStyle = "deeppink";
            ctx.font = "bold 13px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(`t = ${tWrapped.toFixed(4)} s`, xT, midY + 30);
            ctx.restore();

            // Label for horizontal line (voltage)
            ctx.save();
            ctx.fillStyle = "deeppink";
            ctx.font = "bold 13px sans-serif";
            ctx.textAlign = "left";
            ctx.fillText(`u(t) = ${uAtT.toFixed(2)} V`, xT + 8, yT - 8);
            ctx.restore();

            // Draw the pink marker
            ctx.fillStyle = "deeppink";
            ctx.beginPath();
            ctx.arc(xT, yT, 6, 0, 2*Math.PI);
            ctx.fill();
        }

        // === 9. Draw legend box with marker explanation ===
        const lx = margin + 10, ly = 10;
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(lx, ly, 200, 90);
        ctx.fillStyle = "#fff";
        ctx.textAlign = "left";
        ctx.font = "12px sans-serif";
        ctx.fillText(`Ã» = ${up.toFixed(1)} V`,        lx+8, ly+20);
        ctx.fillText(`f = ${f.toFixed(1)} Hz`,        lx+8, ly+38);
        ctx.fillText(`Ï = ${(phi*180/Math.PI).toFixed(1)}Â°`, lx+8, ly+56);
        // Dot legend
        ctx.fillStyle = "deeppink";
        ctx.beginPath();
            ctx.arc(lx+8, ly+76, 6, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.font = "12px sans-serif";
        ctx.fillText("aktueller Zeitpunkt t", lx+20, ly+80);
        }

        function calculate_Rechteck() {
            let result_Rechteck = ``;

            const up = document.getElementById("up-Rechteck").value;
            const upp = document.getElementById("upp-Rechteck").value;
            const Ueff = document.getElementById("Ueff-Rechteck").value;

            // Calculate missing up (peak)
            if (!up) {
                if (upp) {
                    result_Rechteck += `
                        Peakspannung &ucirc; =
                        <div class="fraction">
                            <span>u<sub>pp</sub></span><br>
                            <span class="fraction-denominator">2</span>
                        </div>
                        = <div class="fraction">
                            <span>${upp}V</span><br>
                            <span class="fraction-denominator">2</span>
                        </div>
                        = ${formatWithPrefix(parseInput(upp)/2, "V")}<br>`;
                }
                if (Ueff) {
                    result_Rechteck += `
                        Peakspannung &ucirc; = U<sub>eff</sub>
                        = ${Ueff}V<br>`;
                }
            }

            // Calculate missing upp (peak-peak)
            if (!upp) {
                if (up) {
                    result_Rechteck += `
                        Peak-Peakspannung u<sub>pp</sub> = 2 &lowast; &ucirc;
                        = 2 &lowast; ${up}V
                        = ${formatWithPrefix(2 * parseInput(up), "V")}<br>`;
                }
                if (Ueff) {
                    result_Rechteck += `
                        Peak-Peakspannung u<sub>pp</sub> = 2 &lowast; U<sub>eff</sub>
                        = 2 &lowast; ${Ueff}V
                        = ${formatWithPrefix(2 * parseInput(Ueff), "V")}<br>`;
                }
            }

            // Calculate missing Ueff (RMS)
            if (!Ueff) {
                if (up) {
                    result_Rechteck += `
                        Effektivspannung U<sub>eff</sub> = &ucirc;
                        = ${up}V<br>`;
                }
                if (upp) {
                    result_Rechteck += `
                        Effektivspannung U<sub>eff</sub> =
                        <div class="fraction">
                            <span>u<sub>pp</sub></span><br>
                            <span class="fraction-denominator">2</span>
                        </div>
                        = <div class="fraction">
                            <span>${upp}V</span><br>
                            <span class="fraction-denominator">2</span>
                        </div>
                        = ${formatWithPrefix(parseInput(upp)/2, "V")}<br>`;
                }
            }

            document.getElementById('result_Rechteck').innerHTML = result_Rechteck;
        }

        function calculate_Dreieck()
        {
            let result_Dreieck = ``;

            const Ueff = document.getElementById("Ueff-Dreieck").value;
            const up = document.getElementById("up-Dreieck").value;
            const upp = document.getElementById("upp-Dreieck").value;

            if(!up)     // Peakwert
            {
                if(upp)
                {
                    result_Dreieck += `
                        Peakspannung &ucirc; = 
                        <div class ="fraction">
                            <span> u<sub>pp</sub> </span><br>
                            <span class="fraction-denominator">2</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${upp}V<br>
                            <span class="fraction-denominator">2</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(upp)/2, "V")}<br>`;
                }

                if(Ueff)
                {
                    result_Dreieck += `
                        Peakspannung &ucirc; = U<sub>eff</sub> &lowast; &radic;3
                    =
                        ${Ueff}V &lowast; &radic;3
                    = ${formatWithPrefix(parseInput(Ueff)*Math.pow(3, 0.5), "V")}<br>`;
                }
            }

            if(!upp)        // Peak-Peakwert
            {
                if(up)
                {
                    result_Dreieck += `
                        Peak-Peakspannung u<sub>pp</sub> =  u<sub>p</sub> &lowast; 2 
                    =
                        ${up}V &lowast; 2 
                    = ${formatWithPrefix(parseInput(up)*2, "V")}<br>`;
                }

                if(Ueff)
                {
                    result_Dreieck += `
                        Peak-Peakspannung u<sub>pp</sub> =  U<sub>eff</sub> &lowast; 2 &lowast; &radic;3
                    =
                        ${Ueff}V &lowast; 2 &lowast; &radic;3
                    = ${formatWithPrefix(parseInput(Ueff)*2*Math.pow(3, 0.5), "V")}<br>`;
                }
            }

            if(!Ueff)      // Effektivwert
            {
                if(up)
                {
                    result_Dreieck += `
                        Effektivspannung U<sub>eff</sub> = 
                        <div class ="fraction">
                            <span> &ucirc; </span><br>
                            <span class="fraction-denominator">&radic;3</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${up}V<br>
                            <span class="fraction-denominator">&radic;3</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(up)/Math.pow(3, 0.5), "V")}<br>`;
                }

                if(upp)
                {
                    result_Dreieck += `
                        Effektivspannung U<sub>eff</sub> = 
                        <div class ="fraction">
                            <span> u<sub>pp</sub> </span><br>
                            <span class="fraction-denominator">2 &lowast; &radic;3</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${upp}V<br>
                            <span class="fraction-denominator">2 &lowast; &radic;3</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(upp)/(2 * Math.pow(3, 0.5)), "V")}<br>`;
                }
            }

            document.getElementById('result_Dreieck').innerHTML = result_Dreieck;
        }

        function calculate_PWM()
        {
            let result_PWM = ``;

            const up = document.getElementById("up-PWM").value;
            const Ueff = document.getElementById("Ueff-PWM").value;
            const f = document.getElementById("f-PWM").value;
            const tin = document.getElementById("tin-PWM").value;
            const T = document.getElementById("T-PWM").value;
            const g = document.getElementById("g-PWM").value;

            if(!up)     // Peakwert
            {
                if(up && g && isPercent)
                { 
                    result_PWM += `
                        Effektivspannung U<sub>eff</sub> = 
                        <div class ="fraction">
                            <span> U<sub>eff</sub> </span><br>
                            <span class="fraction-denominator">&radic;g</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${Ueff}V<br>
                            <span class="fraction-denominator">&radic;${g}%</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(Ueff)/(Math.pow(parseInput(g)/100, 0.5)), "V")}<br>`;
                }

                if(up && g && !isPercent)
                { 
                    result_PWM += `
                        Effektivspannung U<sub>eff</sub> = 
                        <div class ="fraction">
                            <span> U<sub>eff</sub> </span><br>
                            <span class="fraction-denominator">&radic;g</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${Ueff}V<br>
                            <span class="fraction-denominator">&radic;${g}</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(Ueff)/(Math.pow(parseInput(g), 0.5)), "V")}<br>`;
                }
            }

            if(!Ueff)     // Effektivwert
            {
                if(up && g && isPercent)
                { 
                    result_PWM += `
                    Effektivspannung U<sub>eff</sub> = &ucirc; &lowast; &radic;g
                =
                    ${up}V &lowast; &radic;${g}%
                = ${formatWithPrefix(parseInput(up) * Math.pow(parseInput(g)/100, 0.5), "V")}<br>`;
                }

                if(up && g && !isPercent)
                { 
                    result_PWM += `
                    Effektivspannung U<sub>eff</sub> = &ucirc; &lowast; &radic;g
                =
                    ${up}V &lowast; &radic;${g}
                = ${formatWithPrefix(parseInput(up) * Math.pow(parseInput(g), 0.5), "V")}<br>`;
                }
            }

            if(!f)      // frequenz
            {
                if(T)
                {
                    result_PWM += `
                        Frequnez f = 
                        <div class ="fraction">
                            <span> 1 </span><br>
                            <span class="fraction-denominator">T</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>1<br>
                            <span class="fraction-denominator">${T}s</span>
                        </div> 
                    = ${formatWithPrefix(1/parseInput(T), "Hz")}<br>`;
                }
            }

            if(!tin)        // Impulsdauer
            {
                if(T && g && isPercent)
                { 
                    result_PWM += `
                    Impulsdauer t<sub>in</sub> = T &lowast; g
                =
                    ${T}s &lowast; ${g}%
                = ${formatWithPrefix(parseInput(T) * parseInput(g)/100, "s")}<br>`;
                }

                if(T && g && !isPercent)
                { 
                    result_PWM += `
                    Impulsdauer t<sub>in</sub> = T &lowast; g
                =
                    ${T}s &lowast; ${g}
                = ${formatWithPrefix(parseInput(T) * parseInput(g), "s")}<br>`;
                }

                if(f && g && isPercent)
                { 
                    result_PWM += `
                        Impulsdauer t<sub>in</sub> = 
                        <div class ="fraction">
                            <span> g </span><br>
                            <span class="fraction-denominator">f</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${g}%<br>
                            <span class="fraction-denominator">${f}Hz</span>
                        </div> 
                = ${formatWithPrefix(parseInput(g)/(parseInput(f) * 100), "s")}<br>`;
                }

                if(f && g && !isPercent)
                { 
                    result_PWM += `
                        Impulsdauer t<sub>in</sub> = 
                        <div class ="fraction">
                            <span> g </span><br>
                            <span class="fraction-denominator">f</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${g}<br>
                            <span class="fraction-denominator">${f}Hz</span>
                        </div> 
                = ${formatWithPrefix(parseInput(g)/parseInput(f), "s")}<br>`;
                }
            }

            if(!T)      // Periodenzeit
            {
                if(f)
                {
                    result_PWM += `
                        Periodendauer T = 
                        <div class ="fraction">
                            <span> 1 </span><br>
                            <span class="fraction-denominator">f</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>1<br>
                            <span class="fraction-denominator">${f}Hz</span>
                        </div> 
                    = ${formatWithPrefix(1/parseInput(f), "s")}<br>`;
                }

                // g = tin/T -> T = tin/g

                if(tin && g && isPercent)
                { 
                    result_PWM += `
                        Periodenzeit = 
                        <div class ="fraction">
                            <span> t<sub>in</sub> </span><br>
                            <span class="fraction-denominator">g</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${tin}s<br>
                            <span class="fraction-denominator">${g}%</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(tin)/(parseInput(g) / 100), "s")}<br>`;
                }

                if(tin && g && !isPercent)
                { 
                    result_PWM += `
                        Periodenzeit = 
                        <div class ="fraction">
                            <span> t<sub>in</sub> </span><br>
                            <span class="fraction-denominator">g</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${tin}s<br>
                            <span class="fraction-denominator">${g}</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(tin)/parseInput(g), "s")}<br>`;
                }
            }

            // g = (Ueff/up)^2
            if(!g)
            {
                if(tin && T)
                {
                    result_PWM += `
                        Duty-Cycle g = 
                        <div class ="fraction">
                            <span> t<sub>in</sub> </span><br>
                            <span class="fraction-denominator">T</span>
                        </div> 
                    =
                        <div class ="fraction">
                            <span>${tin}s<br>
                            <span class="fraction-denominator">${T}s</span>
                        </div> 
                    = ${formatWithPrefix(parseInput(tin)/parseInput(T), "")}
                    = ${formatWithPrefix(parseInput(tin) *100/parseInput(T), "%")}<br>`;
                }

                if(Ueff && up)
                {
                    result_PWM += `
                        Duty-Cycle g = 
                        (<div class ="fraction">
                            <span> U<sub>eff</sub> </span><br>
                            <span class="fraction-denominator">&ucirc;</span>
                        </div>)<sup>2</sup>
                    =
                        (<div class ="fraction">
                            <span>${Ueff}V<br>
                            <span class="fraction-denominator">${up}V</span>
                        </div>)<sup>2</sup>
                    = ${formatWithPrefix(Math.pow(parseInput(Ueff)/parseInput(up),2), "")}
                    = ${formatWithPrefix(100 * Math.pow(parseInput(Ueff)/parseInput(up),2), "%")}<br>`;
                }
            }


            document.getElementById('result_PWM').innerHTML = result_PWM;
        }

    </script>
</body>
</html>
